# 10Ké™æ€å§¿æ€æ‰¹é‡ç”Ÿæˆç³»ç»Ÿ - ä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ‰¹é‡ç”Ÿæˆç³»ç»Ÿï¼Œç”¨äºä»10Kæ–‡æœ¬æè¿°ç”Ÿæˆé™æ€3Då§¿æ€ã€‚

### ä¸»è¦ç‰¹æ€§

âœ… **å¤šGPUå¹¶è¡Œ**: è‡ªåŠ¨å°†10Kæ•°æ®åˆ†æˆ3ä»½ï¼Œåœ¨GPU 1ã€2ã€3ä¸Šå¹¶è¡Œç”Ÿæˆ  
âœ… **æ™ºèƒ½å‘½å**: æ–‡ä»¶ä»¥åŠ¨ä½œæ–‡æœ¬å‘½åï¼ˆå¦‚ `arching_back.png`ï¼‰  
âœ… **åŒç›®å½•ç»“æ„**: ä¸´æ—¶æ–‡ä»¶å’Œæœ€ç»ˆç»“æœåˆ†å¼€å­˜å‚¨  
âœ… **å®Œæ•´è¾“å‡º**: æ¯ä¸ªå§¿æ€ç”ŸæˆPNGã€JSONã€NPYä¸‰ç§æ ¼å¼  
âœ… **è¿›åº¦ç›‘æ§**: å®æ—¶æŸ¥çœ‹ç”Ÿæˆè¿›åº¦  
âœ… **è‡ªåŠ¨æ¢å¤**: æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆè·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶ï¼‰  

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
MARDM/
â”œâ”€â”€ 10Ké™æ€åŠ¨ä½œæè¿°.md              # è¾“å…¥ï¼š10Kæ¡æ–‡æœ¬æè¿°
â”œâ”€â”€ batch_generate_10k.py           # æ ¸å¿ƒç”Ÿæˆè„šæœ¬
â”œâ”€â”€ run_10k_generation.sh           # ä¸»æ§è„šæœ¬ï¼ˆä¸€é”®å¯åŠ¨ï¼‰
â”œâ”€â”€ monitor_progress.sh             # è¿›åº¦ç›‘æ§è„šæœ¬
â”œâ”€â”€ SinglePose_temp/                # ä¸´æ—¶ç›®å½•ï¼ˆç¼“å­˜ï¼‰
â”‚   â”œâ”€â”€ gpu1/                       # GPU 1çš„ä¸´æ—¶æ–‡ä»¶
â”‚   â”œâ”€â”€ gpu2/                       # GPU 2çš„ä¸´æ—¶æ–‡ä»¶
â”‚   â””â”€â”€ gpu3/                       # GPU 3çš„ä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ SinglePose/                     # æœ€ç»ˆç»“æœç›®å½•
â”‚   â”œâ”€â”€ arching_back.png            # ç¤ºä¾‹ï¼šå›¾åƒ
â”‚   â”œâ”€â”€ arching_back.json           # ç¤ºä¾‹ï¼šJSONå§¿æ€ç‚¹äº‘
â”‚   â”œâ”€â”€ arching_back.npy            # ç¤ºä¾‹ï¼šNPYæ–‡ä»¶
â”‚   â””â”€â”€ ...                         # 10,000ä¸ªå§¿æ€ Ã— 3ç§æ ¼å¼
â”œâ”€â”€ split_data/                     # åˆ†å‰²åçš„æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ gpu1_data.txt
â”‚   â”œâ”€â”€ gpu2_data.txt
â”‚   â””â”€â”€ gpu3_data.txt
â””â”€â”€ logs/                           # æ—¥å¿—æ–‡ä»¶
    â”œâ”€â”€ gpu1.log
    â”œâ”€â”€ gpu2.log
    â””â”€â”€ gpu3.log
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æ‰¹é‡ç”Ÿæˆ
./run_10k_generation.sh
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. è‡ªåŠ¨åˆ†å‰²10Kæ•°æ®ä¸º3ä»½
2. åœ¨GPU 1ã€2ã€3ä¸Šå¹¶è¡Œå¯åŠ¨ç”Ÿæˆä»»åŠ¡
3. åå°è¿è¡Œï¼Œè¾“å‡ºæ—¥å¿—åˆ° `logs/` ç›®å½•

### æ–¹æ³•2: ç›‘æ§è¿›åº¦

åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œï¼š

```bash
# å®æ—¶ç›‘æ§è¿›åº¦
./monitor_progress.sh
```

æ˜¾ç¤ºå†…å®¹ï¼š
- å·²ç”Ÿæˆæ–‡ä»¶æ•°é‡å’Œç™¾åˆ†æ¯”
- è¿›åº¦æ¡
- GPUè¿›ç¨‹çŠ¶æ€
- æœ€è¿‘ç”Ÿæˆçš„æ–‡ä»¶
- é¢„è®¡å‰©ä½™æ—¶é—´

---

## ğŸ“Š è¾“å‡ºæ ¼å¼

### æ–‡ä»¶å‘½åè§„åˆ™

åŸå§‹æ–‡æœ¬: `A person arching back`  
ç”Ÿæˆæ–‡ä»¶:
- `arching_back.png` - 3Då¯è§†åŒ–å›¾åƒ
- `arching_back.json` - JSONæ ¼å¼å§¿æ€æ•°æ®
- `arching_back.npy` - NumPyæ•°ç»„æ ¼å¼

**å‘½åè½¬æ¢è§„åˆ™**:
1. ç§»é™¤ "A person " å‰ç¼€
2. ç©ºæ ¼æ›¿æ¢ä¸ºä¸‹åˆ’çº¿
3. ç§»é™¤éæ³•å­—ç¬¦
4. é™åˆ¶é•¿åº¦ä¸º200å­—ç¬¦

### PNGå›¾åƒ

- **æ ¼å¼**: PNG
- **å¤§å°**: çº¦130KB
- **åˆ†è¾¨ç‡**: 1200Ã—1200 (dpi=150)
- **å†…å®¹**: 3Déª¨æ¶å¯è§†åŒ–ï¼ŒåŒ…å«22ä¸ªå…³èŠ‚ç‚¹å’Œéª¨éª¼è¿æ¥

### JSONæ–‡ä»¶

```json
{
  "caption": "A person arching back",
  "frame_index": 8,
  "num_joints": 22,
  "joints": [
    [0.0084, 0.9669, 0.0042],  // å…³èŠ‚ç‚¹0: éª¨ç›† (X, Y, Z)
    [0.0632, 0.8582, 0.0012],  // å…³èŠ‚ç‚¹1: å³é«‹
    // ... æ›´å¤šå…³èŠ‚ç‚¹
  ],
  "joint_names": [
    "pelvis", "left_hip", "right_hip", "spine1",
    // ... æ›´å¤šåç§°
  ]
}
```

### NPYæ–‡ä»¶

- **æ ¼å¼**: NumPyæ•°ç»„
- **å½¢çŠ¶**: `(22, 3)`
- **æ•°æ®ç±»å‹**: `float32`
- **å†…å®¹**: 22ä¸ªå…³èŠ‚ç‚¹çš„XYZåæ ‡ï¼ˆå•ä½ï¼šç±³ï¼‰

```python
import numpy as np
pose = np.load('arching_back.npy')
# pose.shape = (22, 3)
# pose[0] = [x, y, z]  # éª¨ç›†ä½ç½®
```

---

## âš™ï¸ é…ç½®å‚æ•°

### ä¸»æ§è„šæœ¬å‚æ•° (`run_10k_generation.sh`)

å¯ä»¥ç¼–è¾‘è„šæœ¬ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š

```bash
# æ•°æ®æ–‡ä»¶
DATASET_FILE="10Ké™æ€åŠ¨ä½œæè¿°.md"

# è¾“å‡ºç›®å½•
TEMP_DIR="./SinglePose_temp"    # ä¸´æ—¶æ–‡ä»¶
FINAL_DIR="./SinglePose"        # æœ€ç»ˆç»“æœ

# Pythonè§£é‡Šå™¨
PYTHON="/data/conda-envs/MARDM/bin/python"
```

### ç”Ÿæˆè„šæœ¬å‚æ•° (`batch_generate_10k.py`)

```bash
python batch_generate_10k.py \
    --text_path split_data/gpu1_data.txt \  # è¾“å…¥æ–‡æœ¬æ–‡ä»¶
    --temp_dir ./SinglePose_temp/gpu1 \     # ä¸´æ—¶ç›®å½•
    --final_dir ./SinglePose \              # æœ€ç»ˆç›®å½•
    --gpu_id 0 \                            # GPU IDï¼ˆåœ¨CUDA_VISIBLE_DEVICESåçš„IDï¼‰
    --batch_size 8 \                        # æ‰¹å¤„ç†å¤§å°
    --sequence_length 16 \                  # ç”Ÿæˆåºåˆ—é•¿åº¦
    --frame_index -1 \                      # æå–å¸§ç´¢å¼•ï¼ˆ-1=ä¸­é—´å¸§ï¼‰
    --time_steps 18 \                       # æ‰©æ•£æ­¥æ•°
    --cfg 4.5                               # CFGå¼ºåº¦
```

---

## ğŸ“ˆ æ€§èƒ½ä¼°ç®—

### ç”Ÿæˆé€Ÿåº¦

- **å•ä¸ªå§¿æ€**: çº¦5ç§’ï¼ˆ16å¸§åºåˆ—ï¼‰
- **æ‰¹å¤„ç†**: 8ä¸ªå§¿æ€/æ‰¹æ¬¡
- **å•GPUé€Ÿåº¦**: çº¦40ç§’/æ‰¹æ¬¡ = çº¦90ä¸ªå§¿æ€/å°æ—¶

### æ€»è€—æ—¶ä¼°ç®—

- **10Kå§¿æ€**: çº¦10,000ä¸ª
- **3ä¸ªGPUå¹¶è¡Œ**: çº¦3,333ä¸ª/GPU
- **é¢„è®¡æ€»è€—æ—¶**: çº¦37å°æ—¶/GPU = **12-15å°æ—¶**ï¼ˆå¹¶è¡Œï¼‰

### ç£ç›˜ç©ºé—´

- **å•ä¸ªå§¿æ€**: çº¦133KBï¼ˆNPY + JSON + PNGï¼‰
- **10Kå§¿æ€**: çº¦1.3GB

---

## ğŸ” ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹å®æ—¶è¿›åº¦

```bash
# æ–¹æ³•1: ä½¿ç”¨ç›‘æ§è„šæœ¬
./monitor_progress.sh

# æ–¹æ³•2: æŸ¥çœ‹æ—¥å¿—
tail -f logs/gpu1.log
tail -f logs/gpu2.log
tail -f logs/gpu3.log

# æ–¹æ³•3: æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
tail -f logs/*.log

# æ–¹æ³•4: ç»Ÿè®¡æ–‡ä»¶æ•°
ls SinglePose/*.npy | wc -l
```

### æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ

```bash
# æŸ¥çœ‹GPUçŠ¶æ€
nvidia-smi

# æŒç»­ç›‘æ§
watch -n 1 nvidia-smi
```

### æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„è¿›ç¨‹
ps aux | grep batch_generate_10k.py

# æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…
ps aux | grep batch_generate_10k.py | grep -v grep
```

---

## ğŸ› ï¸ å¸¸è§æ“ä½œ

### æš‚åœç”Ÿæˆ

```bash
# æŸ¥æ‰¾è¿›ç¨‹ID
ps aux | grep batch_generate_10k.py

# æš‚åœè¿›ç¨‹ï¼ˆå‘é€SIGSTOPï¼‰
kill -STOP <PID>

# æ¢å¤è¿›ç¨‹ï¼ˆå‘é€SIGCONTï¼‰
kill -CONT <PID>
```

### åœæ­¢ç”Ÿæˆ

```bash
# ä¼˜é›…åœæ­¢ï¼ˆå‘é€SIGTERMï¼‰
pkill -f batch_generate_10k.py

# å¼ºåˆ¶åœæ­¢ï¼ˆå‘é€SIGKILLï¼‰
pkill -9 -f batch_generate_10k.py
```

### é‡æ–°å¯åŠ¨

```bash
# è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶
./run_10k_generation.sh
```

### æ¸…ç†ä¸´æ—¶æ–‡ä»¶

```bash
# æ¸…ç†ä¸´æ—¶ç›®å½•
rm -rf SinglePose_temp/*

# ä¿ç•™æœ€ç»ˆç»“æœï¼Œæ¸…ç†å…¶ä»–
rm -rf SinglePose_temp split_data logs
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: GPUå†…å­˜ä¸è¶³

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "CUDA out of memory"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å‡å°æ‰¹å¤„ç†å¤§å°
# ç¼–è¾‘ run_10k_generation.shï¼Œä¿®æ”¹ --batch_size å‚æ•°
--batch_size 4  # ä»8æ”¹ä¸º4
```

### é—®é¢˜2: è¿›ç¨‹æ„å¤–é€€å‡º

**ç—‡çŠ¶**: è¿›ç¨‹ä¸åœ¨è¿è¡Œï¼Œä½†æœªå®Œæˆæ‰€æœ‰ä»»åŠ¡

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥çœ‹æ—¥å¿—æ‰¾å‡ºé”™è¯¯åŸå› 
tail -100 logs/gpu1.log

# 2. é‡æ–°å¯åŠ¨ï¼ˆä¼šè·³è¿‡å·²å®Œæˆçš„ï¼‰
./run_10k_generation.sh
```

### é—®é¢˜3: æ–‡ä»¶åå†²çª

**ç—‡çŠ¶**: ä¸åŒæè¿°ç”Ÿæˆç›¸åŒæ–‡ä»¶å

**è§£å†³æ–¹æ¡ˆ**:
- è„šæœ¬å·²å¤„ç†å¤§éƒ¨åˆ†æƒ…å†µ
- å¦‚æœ‰å†²çªï¼Œåç”Ÿæˆçš„ä¼šè¦†ç›–å…ˆç”Ÿæˆçš„
- å¯ä»¥åœ¨ `batch_generate_10k.py` ä¸­ä¿®æ”¹ `sanitize_filename` å‡½æ•°

### é—®é¢˜4: ç”Ÿæˆé€Ÿåº¦å¤ªæ…¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å‡å°‘åºåˆ—é•¿åº¦ï¼ˆç‰ºç‰²è´¨é‡æ¢é€Ÿåº¦ï¼‰
--sequence_length 8  # ä»16æ”¹ä¸º8ï¼Œé€Ÿåº¦æå‡çº¦2å€

# 2. å‡å°‘æ‰©æ•£æ­¥æ•°
--time_steps 10  # ä»18æ”¹ä¸º10

# 3. å¢åŠ æ‰¹å¤„ç†å¤§å°ï¼ˆå¦‚æœGPUå†…å­˜è¶³å¤Ÿï¼‰
--batch_size 16  # ä»8æ”¹ä¸º16
```

### é—®é¢˜5: æŸäº›æè¿°ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—ä¸­æœ‰ "å¤„ç†å¤±è´¥" çš„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- è¿™æ˜¯æ­£å¸¸çš„ï¼ŒæŸäº›å¤æ‚æè¿°å¯èƒ½ç”Ÿæˆå¤±è´¥
- è„šæœ¬ä¼šç»§ç»­å¤„ç†å…¶ä»–æè¿°
- æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼Œäº†è§£å¤±è´¥åŸå› 
- å¯ä»¥å•ç‹¬é‡æ–°ç”Ÿæˆå¤±è´¥çš„æè¿°

---

## ğŸ“‹ é«˜çº§ç”¨æ³•

### åªç”Ÿæˆç‰¹å®šèŒƒå›´

```bash
# åªç”Ÿæˆå‰1000ä¸ª
head -1000 all_10k_descriptions.txt > test_1000.txt

python batch_generate_10k.py \
    --text_path test_1000.txt \
    --final_dir ./SinglePose_test \
    --gpu_id 0
```

### è°ƒæ•´ç”Ÿæˆè´¨é‡

```bash
# é«˜è´¨é‡æ¨¡å¼ï¼ˆæ›´æ…¢ï¼‰
python batch_generate_10k.py \
    --text_path data.txt \
    --time_steps 50 \
    --cfg 5.0 \
    --sequence_length 32 \
    --gpu_id 0

# å¿«é€Ÿæ¨¡å¼ï¼ˆè´¨é‡ç¨å·®ï¼‰
python batch_generate_10k.py \
    --text_path data.txt \
    --time_steps 10 \
    --cfg 3.0 \
    --sequence_length 8 \
    --gpu_id 0
```

### å•GPUè¿è¡Œ

```bash
# åªåœ¨GPU 1ä¸Šè¿è¡Œå…¨éƒ¨10K
CUDA_VISIBLE_DEVICES=1 python batch_generate_10k.py \
    --text_path all_10k_descriptions.txt \
    --final_dir ./SinglePose \
    --gpu_id 0 \
    --batch_size 8
```

### è‡ªå®šä¹‰GPUåˆ†é…

```bash
# ä½¿ç”¨GPU 0ã€2ã€4
CUDA_VISIBLE_DEVICES=0 python batch_generate_10k.py --text_path split_data/gpu1_data.txt --gpu_id 0 &
CUDA_VISIBLE_DEVICES=2 python batch_generate_10k.py --text_path split_data/gpu2_data.txt --gpu_id 0 &
CUDA_VISIBLE_DEVICES=4 python batch_generate_10k.py --text_path split_data/gpu3_data.txt --gpu_id 0 &
```

---

## ğŸ“Š ç»“æœéªŒè¯

### æ£€æŸ¥å®Œæ•´æ€§

```bash
# ç»Ÿè®¡æ–‡ä»¶æ•°é‡
echo "NPYæ–‡ä»¶: $(find SinglePose -name '*.npy' | wc -l)"
echo "JSONæ–‡ä»¶: $(find SinglePose -name '*.json' | wc -l)"
echo "PNGæ–‡ä»¶: $(find SinglePose -name '*.png' | wc -l)"

# åº”è¯¥éƒ½æ˜¯10,000ï¼ˆæˆ–æ¥è¿‘ï¼‰
```

### éšæœºæŠ½æ ·æ£€æŸ¥

```bash
# éšæœºæŸ¥çœ‹10ä¸ªç”Ÿæˆçš„æ–‡ä»¶
find SinglePose -name "*.png" | shuf -n 10

# ä½¿ç”¨å›¾ç‰‡æŸ¥çœ‹å™¨æ‰“å¼€
```

### éªŒè¯æ•°æ®æ ¼å¼

```python
import numpy as np
import json
import os

# æ£€æŸ¥ä¸€ä¸ªæ ·æœ¬
sample = "arching_back"

# æ£€æŸ¥NPY
npy_data = np.load(f"SinglePose/{sample}.npy")
print(f"NPYå½¢çŠ¶: {npy_data.shape}")  # åº”è¯¥æ˜¯ (22, 3)

# æ£€æŸ¥JSON
with open(f"SinglePose/{sample}.json") as f:
    json_data = json.load(f)
print(f"JSONå…³èŠ‚ç‚¹æ•°: {json_data['num_joints']}")  # åº”è¯¥æ˜¯ 22

# æ£€æŸ¥PNG
print(f"PNGå¤§å°: {os.path.getsize(f'SinglePose/{sample}.png')} å­—èŠ‚")
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å…ˆå°è§„æ¨¡æµ‹è¯•**: ç”¨100æ¡æ•°æ®æµ‹è¯•ï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸
2. **ç›‘æ§GPUæ¸©åº¦**: é•¿æ—¶é—´è¿è¡Œæ³¨æ„æ•£çƒ­
3. **å®šæœŸå¤‡ä»½**: ç”Ÿæˆè¿‡ç¨‹ä¸­å®šæœŸå¤‡ä»½ `SinglePose` ç›®å½•
4. **æ—¥å¿—ä¿ç•™**: ä¿ç•™æ—¥å¿—æ–‡ä»¶ç”¨äºé—®é¢˜æ’æŸ¥
5. **ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ï¼ˆè‡³å°‘2GBï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `10Ké™æ€åŠ¨ä½œæè¿°.md` - è¾“å…¥æ•°æ®é›†
- `batch_generate_10k.py` - æ ¸å¿ƒç”Ÿæˆè„šæœ¬
- `å•å¸§å§¿æ€ç”Ÿæˆä½¿ç”¨è¯´æ˜.md` - å•å¸§ç”Ÿæˆè¯¦ç»†è¯´æ˜
- `å…³èŠ‚ç‚¹é¡ºåºè¯´æ˜.md` - å…³èŠ‚ç‚¹å®šä¹‰

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¯åŠ¨ç”Ÿæˆ
./run_10k_generation.sh

# ç›‘æ§è¿›åº¦
./monitor_progress.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/gpu1.log

# æŸ¥çœ‹GPU
nvidia-smi

# ç»Ÿè®¡è¿›åº¦
ls SinglePose/*.npy | wc -l

# åœæ­¢æ‰€æœ‰
pkill -f batch_generate_10k.py

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf SinglePose_temp/*
```

---

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025å¹´12æœˆ2æ—¥  
**é¢„è®¡å®Œæˆæ—¶é—´**: 12-15å°æ—¶ï¼ˆ3 GPUå¹¶è¡Œï¼‰


